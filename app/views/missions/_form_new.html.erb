<%= form_for(@mission,:html => {:class => 'form-horizontal'}) do |f| %>
<% if f.object.errors.any? %>
<div class="form-group" style="padding-left:2em; padding-right:2em;">
  <div class="alert alert-danger" role="alert">
    <div id="clear"></div>
    <div id="error">
      <p class="title">
        <%= t 'activemodel.errors.messages', count: f.object.errors.count %>
      </p>
      <ul>
        <% f.object.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
    <div id="clear"></div>
  </div>
</div>
<% end %>
<%= f.hidden_field :user_id, :value =>  current_logged_user.id%>
<div class="form-group">
  <%= label_tag 'user', "Owner*", class: 'col-sm-2 col-md-2 control-label' %>
  <div class="col-sm-10 col-md-10">
    <%= f.text_field :user, class: 'form-control', value: current_logged_user.firstname.capitalize + " " + current_logged_user.lastname.capitalize,readonly: true %>
  </div>
</div>
<div class="form-group">
  <%= label_tag 'project_name', "Project name*", class: 'col-sm-2 col-md-2 control-label' %>
  <div class="col-sm-10 col-md-10">
    <%= f.text_field :project_name, class: 'form-control'%>
  </div>
</div>
<div class="form-group">
  <%= label_tag 'project_name', "Location*", class: 'col-sm-2 col-md-2 control-label' %>
  <div class="col-sm-10 col-md-10">
    <%= f.text_field :location, class: 'form-control'%>
  </div>
</div>
<div class="form-group">
  <%= label_tag 'description', "Description*", class: 'col-sm-2 col-md-2 control-label' %>
  <div class="col-sm-10 col-md-10">
    <%= f.text_area :description, class: 'form-control'%>
  </div>
</div>
<style>
.csv
{
	visibility: hidden;
}
#csv_logo:hover
{
	cursor: pointer;
}
.csv:fullscreen
{
	visibility:visible;
	display: flex;
  justify-content: center;
	height:600px;
	width:100%;
}
</style>
<div class="form-group">
  <%= label_tag 'documents', "Documents", class: 'col-sm-2 col-md-2 control-label' %>
  <div class="col-sm-10 col-md-10">
    <%if @mission.documents == nil%>
			<%= link_to "Add Document", new_document_path + "?file_type=csv&purpose=mission&id=#{@mission.id}" %>
		<%elsif @mission.documents == "NULL" or @mission.documents == "nil"%>
			<%= link_to "Add Documents", new_document_path + "?file_type=csv&purpose=mission&id=#{@mission.id}" %>
		<% else %>
			<div style="position:relative; top:0px; left:0px; width:100%; height:70px;">
				<%
				@width = 15
				@height = 30
				
				@nbCol = 100/@width
				@stepHeight = 80
				@iterator = 0
				%>
				<%@docs = @mission.documents.split(';').each do |doc|%>
				<%@col = @iterator%@nbCol
				@row = @iterator/@nbCol
				%>
				<div style="position:absolute; top:<%=@stepHeight * @row%>px; left:<%=@width * @col%>%; width:<%=@width%>%; height:20px; text-align:center;">
					<%= Document.find(doc).name%>
				</div>
				<div style="position:absolute; top:<%=@stepHeight * @row + 20%>px; left:<%=@width * @col%>%; width:<%=@width%>%; height:30px; text-align:center;">
					<a href="<%= Document.find(@mission.documents).attachment %>">
						<% @rowarraydisp = CSV.read("public" + Document.find(doc).attachment_url, :headers => false, :col_sep => ";") %>
					</a>
					<div id="fullScreenElement1" class="button" onclick="display_csv('csv<%=@iterator%>');">
						<p><img id="csv_logo" src="/csv_logo.png" width="20px" height="20px"></img></p>
					</div>
					<div id="csv<%=@iterator%>" class = "csv">
						<table style="display:block; overflow:auto; align-self: center;">
							<% @rowarraydisp.each do |row| %>
								<tr>
									<% row.each do |val|%>
									<td>
										<%= val %>
									</td>
									<% end %>
								</tr>
							<% end %>
						</table>
					</div>
				</div>
				<div style="position:absolute; top:<%=@stepHeight * @row + 50%>px; left:<%=@width * @col%>%; width:<%=@width%>%; height:20px; text-align:center;">
					<%= link_to "Remove document", documents_destroy_path + "?id=#{doc}&purpose=mission&purpose_id=#{@mission.id}" %>
				</div>
				<%@iterator = @iterator + 1%>
				<%end%>
				
				<div style="position:absolute; top:20px; left:50%; width:30%; height:30px; text-align:center;">
					<%= link_to "Add Documents", new_document_path + "?file_type=csv&purpose=mission&id=#{@mission.id}" %>
				</div>
			</div>
		<%end%>
  </div>
	<script type="text/javascript">
		function display_csv(div) {
			document.getElementById(div).requestFullscreen();
		}
	</script>
</div>
<div class="form-group">
  <%= label_tag 'starting_date', "Starting date*", class: 'col-sm-2 col-md-2 control-label' %>
  <div class="col-sm-10 col-md-10">
    <%= f.date_field :starting_date, class: 'form-control'%>
  </div>
</div>
<div class="form-group">
  <%= label_tag 'ending_date', "Ending date", class: 'col-sm-2 col-md-2 control-label' %>
  <div class="col-sm-10 col-md-10">
    <%= f.date_field :ending_date, class: 'form-control'%>
  </div>
</div>
<div class="form-group">
  <div class="col-sm-12">
    <%= f.submit :class => "btn btn-primary btn-block btn-lg" %>
  </div>
</div>
<% end %>
